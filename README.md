# Библиотека искусственного интеллекта для 1С

Библиотека искусственного интеллекта (БИИ) предоставляет возможность интеграции различных функций искусственного интеллекта в вашу систему 1С. Эта библиотека позволяет использовать современные технологии ИИ от различных провайдеров для генерации текста, создания векторных представлений, преобразования аудио в текст, текста в аудио, создания изображений и многого другого.

## Содержание

- [Начало работы](#начало-работы)
- [Провайдеры](#провайдеры)
- [Модели ИИ](#модели-ии)
- [Функции библиотеки](#функции-библиотеки)
  - [Генерация текста](#генерация-текста)
  - [Векторные представления](#векторные-представления)
  - [Работа с векторными базами](#работа-с-векторными-базами)
  - [Преобразование аудио в текст](#преобразование-аудио-в-текст)
  - [Преобразование текста в аудио](#преобразование-текста-в-аудио)
  - [Генерация изображений](#генерация-изображений)
  - [Интеграция с Telegram](#интеграция-с-telegram)
- [Примеры использования](#примеры-использования)

## Начало работы

Для начала работы с библиотекой БИИ необходимо:

1. Добавить библиотеку в вашу конфигурацию 1С
2. Настроить провайдеров ИИ и получить ключи доступа
3. Создать модели с необходимыми параметрами

При первом использовании библиотека автоматически создаст все необходимые справочники:
- БИИ_Провайдеры - провайдеры сервисов искусственного интеллекта
- БИИ_Модели - модели ИИ, связанные с провайдерами

## Провайдеры

Библиотека поддерживает следующие провайдеры ИИ:

| Провайдер | Описание |
|-----------|----------|
| Локальный | Локальный провайдер, позволяющий работать с векторной базой без подключения к внешним API |
| OpenAI | Доступ к моделям GPT и другим сервисам OpenAI |
| Deepseek | Доступ к моделям Deepseek для генерации текста |
| 01AI | Доступ к моделям 01AI для генерации текста |
| ZHIPU | Доступ к моделям ZHIPU для генерации текста |
| Anthropic | Доступ к моделям Claude от Anthropic |
| Google | Доступ к моделям Gemini от Google |
| NVIDIA | Доступ к моделям NVIDIA для генерации текста |
| Yandex | Доступ к YandexGPT и другим сервисам Яндекс |
| Сбер GigaChat | Доступ к моделям GigaChat от Сбербанка |
| Сбер Salute | Доступ к сервисам распознавания и синтеза речи от Сбербанка |
| VseGPT | Доступ к моделям через прокси-сервис VseGPT |

Для настройки провайдера необходимо указать:
- Наименование (выбирается из списка)
- Ключ доступа к API (получается у соответствующего провайдера)
- Каталог (используется для некоторых провайдеров)

## Модели ИИ

Библиотека поддерживает различные типы моделей для разных задач:

### Модели для генерации текста (Назначение "Генерация")

- OpenAI: o1-mini, gpt-4o-mini, gpt-4o
- Deepseek: deepseek-chat, deepseek-reasoner
- 01AI: yi-large
- ZHIPU: glm-4-0520
- Anthropic: claude-3-opus-20240229, claude-3-5-sonnet-20240620
- Google: gemini-pro
- NVIDIA: nvidia/nemotron-4-340b-instruct
- Yandex: yandexgpt, yandexgpt-lite
- Сбер GigaChat: GigaChat, GigaChat-Pro
- VseGPT: openai/gpt-4o-mini, openai/gpt-4o

### Модели для векторных представлений (Назначение "Вектор")

- OpenAI: text-embedding-3-small, text-embedding-3-large
- Yandex: text-search-doc, text-search-query
- Локальный: создание эмбеддингов на основе локальных алгоритмов

### Модели для преобразования аудио в текст (Назначение "Аудио2Текст")

- Yandex: general
- Сбер Salute: saluteSTT

### Модели для преобразования текста в аудио (Назначение "Текст2Аудио")

- OpenAI: tts-1, tts-1-hd
- Сбер Salute: saluteTTS

### Модели для генерации изображений (Назначение "Текст2Графика")

- Yandex: различные модели генерации изображений

## Функции библиотеки

### Генерация текста

#### Функция `Генерация`

```bsl
Функция Генерация(промт, модель, семплирование=0, инструменты=неопределено, системный_промт=неопределено, полный_результат=ложь, схема_ответа=неопределено, опции=неопределено) экспорт
```

Параметры:
- `промт` - запрос пользователя
- `модель` - ссылка на элемент справочника БИИ_Модели (с назначением "Генерация")
- `семплирование` - уровень "креативности" ответа (от 0 до 1)
- `инструменты` - дополнительные инструменты для моделей (например, для функции поиска)
- `системный_промт` - настройка поведения модели, системные инструкции
- `полный_результат` - если истина, вернет полный ответ от API включая метаданные
- `схема_ответа` - JSON схема для структурирования ответа
- `опции` - дополнительные параметры

Результат:
- Строка с сгенерированным текстом или структура с полным ответом

#### Функция `Ответ`

```bsl
Функция Ответ(промт, модель, инструменты=неопределено, опции=неопределено, полный_ответ=ложь) экспорт
```

Упрощенный вариант функции Генерация, с меньшим количеством настроек.

### Векторные представления

#### Функция `Вектор`

```bsl
Функция Вектор(текст, модель) экспорт
```

Параметры:
- `текст` - исходный текст для преобразования в вектор
- `модель` - ссылка на элемент справочника БИИ_Модели (с назначением "Вектор")

Результат:
- Массив чисел (векторное представление текста) или неопределено в случае ошибки

### Работа с векторными базами

#### Функция `СоздатьВекторнуюБазу`

```bsl
Функция СоздатьВекторнуюБазу(имя, провайдер) экспорт
```

Параметры:
- `имя` - имя базы
- `провайдер` - ссылка на элемент справочника БИИ_Провайдеры

Результат:
- Идентификатор созданной базы или неопределено, если база не создана

#### Функция `ЗагрузитьФайл`

```bsl
Функция ЗагрузитьФайл(имяфайла, данныефайла, провайдер) экспорт
```

Параметры:
- `имяфайла` - имя файла
- `данныефайла` - двоичные данные файла
- `провайдер` - ссылка на элемент справочника БИИ_Провайдеры

Результат:
- Идентификатор загруженного файла или неопределено, если файл не загружен

#### Функция `РазместитьФайл`

```bsl
Функция РазместитьФайл(база, идфайла, провайдер) экспорт
```

Параметры:
- `база` - идентификатор векторной базы
- `идфайла` - идентификатор файла в хранилище
- `провайдер` - ссылка на элемент справочника БИИ_Провайдеры

Результат:
- Идентификатор файла в векторной базе или неопределено, если файл не размещен

### Преобразование аудио в текст

#### Функция `ПолучитьТекстИзАудио`

```bsl
Функция ПолучитьТекстИзАудио(аудио, модель) экспорт
```

Параметры:
- `аудио` - двоичные данные аудиофайла
- `модель` - ссылка на элемент справочника БИИ_Модели (с назначением "Аудио2Текст")

Результат:
- Распознанный текст или неопределено в случае ошибки

### Преобразование текста в аудио

#### Функция `ПолучитьАудиоИзТекста`

```bsl
Функция ПолучитьАудиоИзТекста(текст, модель, голос="alloy") экспорт
```

Параметры:
- `текст` - исходный текст для преобразования в аудио
- `модель` - ссылка на элемент справочника БИИ_Модели (с назначением "Текст2Аудио")
- `голос` - название голоса для синтеза (для OpenAI: alloy, echo, fable, onyx, nova, shimmer)

Результат:
- Двоичные данные аудиофайла или неопределено в случае ошибки

### Генерация изображений

#### Функция `ЗапроситьИзображение`

```bsl
Функция ЗапроситьИзображение(промт, модель) экспорт
```

Параметры:
- `промт` - описание изображения
- `модель` - ссылка на элемент справочника БИИ_Модели (с назначением "Текст2Графика")

Результат:
- Идентификатор запроса на создание изображения (для последующего использования в функции ПолучитьИзображение) или неопределено в случае ошибки

#### Функция `ПолучитьИзображение`

```bsl
Функция ПолучитьИзображение(идентификатор, модель) экспорт
```

Параметры:
- `идентификатор` - идентификатор изображения, полученный ранее функцией ЗапроситьИзображение
- `модель` - ссылка на элемент справочника БИИ_Модели (с назначением "Текст2Графика")

Результат:
- Изображение, закодированное в base64 или неопределено

### Интеграция с Telegram

#### Функция `ПолучитьСообщениеТелеграм`

```bsl
Функция ПолучитьСообщениеТелеграм(бот) экспорт
```

Параметры:
- `бот` - ссылка на элемент справочника БИИ_Боты

Результат:
- Структура с информацией о полученном сообщении или неопределено, если новых сообщений нет

#### Функция `ОтправитьСообщениеТелеграм`

```bsl
Функция ОтправитьСообщениеТелеграм(бот, чат, текстСообщения, меню=неопределено) экспорт
```

Параметры:
- `бот` - ссылка на элемент справочника БИИ_Боты
- `чат` - идентификатор чата
- `текстСообщения` - текст сообщения для отправки
- `меню` (необяз.) - структура содержащая меню

Результат:
- Истина если сообщение отправлено успешно, иначе Ложь

#### Функция `ОтправитьАудиоТелеграм`

```bsl
Функция ОтправитьАудиоТелеграм(бот, чат, аудио) экспорт
```

Параметры:
- `бот` - ссылка на элемент справочника БИИ_Боты
- `чат` - идентификатор чата
- `аудио` - двоичные данные аудиофайла

Результат:
- Код состояния HTTP-ответа

#### Функция `ПолучитьАудиоИзСообщения`

```bsl
Функция ПолучитьАудиоИзСообщения(бот, сообщение) экспорт
```

Параметры:
- `бот` - ссылка на элемент справочника БИИ_Боты
- `сообщение` - структура сообщения, полученная от ПолучитьСообщениеТелеграм

Результат:
- Двоичные данные аудиофайла или неопределено, если в сообщении нет аудио

## Примеры использования

### Генерация текста

```bsl
// Получение модели из справочника
Модель = Справочники.БИИ_Модели.НайтиПоНаименованию("gpt-4o");

// Простая генерация текста
Результат = БиблиотекаИскусственногоИнтеллекта.Генерация("Расскажи о 1С", Модель);

// Генерация с системным промтом
СистемныйПромт = "Ты эксперт по программированию на 1С. Отвечай кратко и по делу.";
Результат = БиблиотекаИскусственногоИнтеллекта.Генерация(
    "Как создать новый документ в 1С?", 
    Модель, 
    0.7, // бóльшая креативность
    Неопределено, 
    СистемныйПромт
);
```

### Работа с векторной базой

```bsl
// Получение провайдера и модели
Провайдер = Справочники.БИИ_Провайдеры.НайтиПоНаименованию("OpenAI");
МодельВектора = Справочники.БИИ_Модели.НайтиПоНаименованию("text-embedding-3-small");

// Создание векторной базы
ИдБазы = БиблиотекаИскусственногоИнтеллекта.СоздатьВекторнуюБазу("БазаДокументации", Провайдер);

// Загрузка файла
ДвоичныеДанные = Новый ДвоичныеДанные("путь_к_файлу.txt");
ИдФайла = БиблиотекаИскусственногоИнтеллекта.ЗагрузитьФайл("документация.txt", ДвоичныеДанные, Провайдер);

// Размещение файла в векторной базе
ИдФайлаВБазе = БиблиотекаИскусственногоИнтеллекта.РазместитьФайл(ИдБазы, ИдФайла, Провайдер);

// Получение вектора для запроса
Вектор = БиблиотекаИскусственногоИнтеллекта.Вектор("Как создать новый документ?", МодельВектора);
```

### Преобразование аудио в текст

```bsl
// Получение модели
МодельSTT = Справочники.БИИ_Модели.НайтиПоНаименованию("general");

// Загрузка аудиофайла
ДвоичныеДанные = Новый ДвоичныеДанные("путь_к_аудио.ogg");

// Распознавание текста
РаспознанныйТекст = БиблиотекаИскусственногоИнтеллекта.ПолучитьТекстИзАудио(ДвоичныеДанные, МодельSTT);
```

### Преобразование текста в аудио

```bsl
// Получение модели
МодельTTS = Справочники.БИИ_Модели.НайтиПоНаименованию("tts-1");

// Создание аудио из текста
Текст = "Привет! Это пример синтеза речи с помощью библиотеки искусственного интеллекта для 1С.";
АудиоДанные = БиблиотекаИскусственногоИнтеллекта.ПолучитьАудиоИзТекста(Текст, МодельTTS, "alloy");

// Сохранение аудио в файл
АудиоДанные.Записать("путь_для_сохранения.mp3");
```

### Генерация изображения

```bsl
// Получение модели
МодельИзображения = Справочники.БИИ_Модели.НайтиПоНаименованию("kandinsky");

// Запрос изображения
Описание = "Красивый пейзаж с горами и озером в стиле акварели";
ИдЗапроса = БиблиотекаИскусственногоИнтеллекта.ЗапроситьИзображение(Описание, МодельИзображения);

// Получение изображения (возможно потребуется подождать)
// Рекомендуется реализовать механизм ожидания
Изображение = БиблиотекаИскусственногоИнтеллекта.ПолучитьИзображение(ИдЗапроса, МодельИзображения);

// Сохранение изображения (base64) в файл
// Для этого требуется дополнительная обработка
```

## Примечания по использованию

1. Для работы библиотеки требуется доступ к интернету.
2. Необходимо получить API-ключи у соответствующих провайдеров.
3. Используйте локальный провайдер для хранения векторной базы на компьютере без необходимости внешних API.
4. Следите за лимитами и стоимостью запросов к внешним API.
5. При работе с большими объемами данных рекомендуется использовать асинхронные методы обработки.
